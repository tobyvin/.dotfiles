#!/bin/sh

swaymsg -t get_tree |
	jq --compact-output '.. | select(.focused? == true and .type == "con") | 
			{ 
				"full_text": (.name // ""), 
				"short_text": ([.app_id, .window_title] | map(select(. != null and . != "")) | (first // "")),
			}
'

swaymsg --monitor -t subscribe '["window", "workspace"]' |
	jq --compact-output --unbuffered '
		if .change == "close" and .container.focused == true then
			{ "full_text": "" }
		elif .change == "focus" or (.change == "title" and .container.focused == true) then
			.container | { 
				"full_text": (.name // ""), 
				"short_text": ([.app_id, .window_title] | map(select(. != null and . != "")) | (first // "")),
			}
		else
			empty
		end
'
